<!DOCTYPE html>
<html>
<%- include partials/head.ejs %>
<body>
<%- include partials/header.ejs %>
<div class="container">
    <div class="jumbotron mb-3">
        <div class="row">
            <div class="col-4">
                <h3 class="text-center jumbotron-third-title">Points</h3>
                <h1 class="text-center jumbotron-third-detail">
                    <%= (user.hasOwnProperty('points') ? parseInt(user.points) : 0) %>
                </h1>
            </div>
            <div class="col-4">
                <h3 class="text-center jumbotron-third-title">Rank</h3>
                <h1 class="text-center jumbotron-third-detail">N/A</h1>
            </div>
            <div class="col-4">
                <h3 class="text-center jumbotron-third-title">Events</h3>
                <h1 class="text-center jumbotron-third-detail"><%= (user.hasOwnProperty('events') ? user.events.length : 0) %></h1>
            </div>
        </div>
    </div>
</div>
<div class="container mb-3">
    <h2>Events</h2>
    <table class="table table-responsive-md mb-3">
        <thead>
        <tr>
            <th scope="col"></th>
            <th scope="col">Date</th>
            <th scope="col">Name</th>
            <th scope="col">Points</th>
        </tr>
        </thead>
        <tbody>
        <% events.sort(function(a, b) {
            a = new Date(a.date);
            b = new Date(b.date);
            return a > b ? -1 : a < b ? 1 : 0;
        });%>
        <% if (events.length > 0) { %>
        <% events = events.slice(0, 5) %>
        <% events.forEach(function(item) { %>
        <tr id="event-<%= item.id %>">
            <% var checked = false;
                if (item.hasOwnProperty('attendees') && item.attendees[user.uid] == true) {
                    checked = true;
                }
            %>
            <th>
                <% if (checked) { %>
                <input id="event-<%= item.id %>-box" class="event-checkbox" type="checkbox" aria-label="<%=item.id%>" checked="true">
                <% } else { %>
                <input id="event-<%= item.id %>-box" class="event-checkbox" type="checkbox" aria-label="<%=item.id%>">
                <% } %>
            </th>
            <td><%= moment(item.date).format("M/D") %></td>
            <td>
                <% if (user.isAdmin || user.isEventAdmin) { %>
                <a class="btn-link" href="/events/update/<%= item.id %>"><%= item.name %></a>
                <% } else { %>
                <%= item.name %>
                <% } %>
                <% if (item.bonus == true || item.bonus === 'true') { %> <span class="text-muted">(BONUS)</span> <% } %> <% if (item.family == true || item.family === 'true') { %> <span class="text-muted">(FAMILY)</span> <% } %> <span class="badge badge-primary"><%= item.type %></span>
            </td>
            <td><%= item.points %></td>
        </tr>
        <%});%>
        <% } %>
        </tbody>
    </table>
    <div class="row">
        <div class="col-lg">
        </div>
        <div class="col-lg-auto">
        </div>
        <div class="col-lg-auto justify-content-end">
            <a href="/events" class="btn btn-outline-secondary mr-2">View All Events</a>
            <button type="button" class="btn btn-primary float-right" id="submit-points-button">Submit</button>
        </div>
    </div>
</div>
<%- include partials/footer.ejs %>
<%- include partials/scripts.ejs %>
<%- include partials/user-event-update.ejs %>
</body>

</html>
