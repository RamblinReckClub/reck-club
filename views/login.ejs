<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="The online home of the Ramblin' Reck Club, a campus organization at the Georgia Institute of Technology dedicated to the promotion of Georgia Tech traditions and spirit and responsible for the Institute's mascot car - the Ramblin' Reck.">
    <meta name="author" content="Ramblin' Reck Club">
    <title><%= title %></title>

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/login.css">
</head>

<body class="container text-center">
<form class="form-signin needs-validation" id="sign-in-form" novalidate>
    <img class="mb-4" src="/img/brand/official-logo.png" alt="" width="100" height="100">
    <div class="message-space"></div>
    <h1 class="mb-3 font-weight-normal">Member Login</h1>
    <label for="inputEmail" class="sr-only">Email address</label>
    <input type="email" id="inputEmail" class="form-control" placeholder="Email address" required autofocus="">
    <div class="invalid-feedback">
        Please enter your email.
    </div>
    <label for="inputPassword" class="sr-only">Password</label>
    <input type="password" id="inputPassword" class="form-control" placeholder="Password" required>
    <div class="invalid-feedback">
        Please enter your password.
    </div>
    <button class="btn btn-lg btn-primary btn-block mb-1" type="submit">Sign in</button>
    <a class="btn btn-link" href="mailto:technology@reckclub.org?subject=Create%20account">Don't have an account?</a>
    <p class="mt-5 mb-3 text-muted">Â© <%= moment().format('YYYY') %> Ramblin' Reck Club. All Rights Reserved.</p>
</form>

<%- include partials/scripts.ejs %>
<script>
    function signIn() {
        $('#message-space').remove();
        $.ajax({
            url: '/login',
            type: 'PUT',
            headers: {
                'user-email': $('#inputEmail').val(),
                'user-password':  $('#inputPassword').val()
            },
            contentType: 'application/json; charset=utf-8',
            success: function (result) {
                // Pass token to redirect?
                console.log(result);
                window.location.replace('/points');
            },
            error: function (error) {
                if (error) {
                    console.log(error.responseJSON.detailedMessage.message);
                    console.log('should append html');
                    displayError(error.responseJSON.detailedMessage.message);
                }
            }
        });
    }

    function displayError(err) {
        $('.message-space').empty().append("    <div class=\"alert alert-danger alert-dismissible show\" role=\"alert\">\n" +
            "        <strong>Error!</strong> <span id=\"error-message\">" + err+ "</span>\n" +
            "        <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\n" +
            "            <span aria-hidden=\"true\">&times;</span>\n" +
            "        </button>\n" +
            "    </div>");
    }

    (function() {
        'use strict';
        window.addEventListener('load', function() {
            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            var forms = document.getElementsByClassName('needs-validation');
            // Loop over them and prevent submission
            var validation = Array.prototype.filter.call(forms, function(form) {
                form.addEventListener('submit', function(event) {
                    event.preventDefault();
                    if (form.checkValidity() === false) {
                        event.stopPropagation();
                    } else {
                        signIn();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();

    // var valid = false;
    // if (valid) {
    //     $('#sign-in-form').on('submit', function(event) {
    //         event.preventDefault();
    //         $.ajax({
    //             url: '/login',
    //             type: 'PUT',
    //             headers: {
    //                 'user-email': 'value1',
    //                 'user-password': 'value2'
    //             },
    //             contentType: 'application/json; charset=utf-8',
    //             success: function (result) {
    //                 // Pass token to redirect?
    //                 console.log(result);
    //             },
    //             error: function (error) {
    //                 console.log(error);
    //             }
    //         });
    //     });
    // }
</script>

</body></html>